name: HACS Validation

on:
  pull_request:
    branches: [ main ]
  push:
    branches: [ main ]

jobs:
  hacs-validation:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: HACS Validation (disabled for now)
        run: |
          echo "‚ÑπÔ∏è HACS validation temporarily disabled"
          echo "   Use manual validation for HACS submission"

      - name: Check HACS requirements
        run: |
          echo "üîç Checking HACS requirements..."
          
          # Check manifest
          if [ ! -f "custom_components/nettleie/manifest.json" ]; then
            echo "‚ùå Missing manifest.json"
            exit 1
          fi
          
          # Check required fields in manifest
          REQUIRED_FIELDS=("domain" "name" "version" "documentation")
          for field in "${REQUIRED_FIELDS[@]}"; do
            if ! jq -e ".$field" custom_components/nettleie/manifest.json > /dev/null; then
              echo "‚ùå Missing required field in manifest: $field"
              exit 1
            fi
          done
          
          # Check config flow
          if [ "$(jq -r '.config_flow' custom_components/nettleie/manifest.json)" != "true" ]; then
            echo "‚ùå config_flow must be true for HACS"
            exit 1
          fi
          
          echo "‚úÖ Manifest validation passed"
          
          # Check __init__.py
          if [ ! -f "custom_components/nettleie/__init__.py" ]; then
            echo "‚ùå Missing __init__.py"
            exit 1
          fi
          
          # Check for setup function
          if ! grep -q "async_setup_entry" custom_components/nettleie/__init__.py; then
            echo "‚ùå Missing async_setup_entry in __init__.py"
            exit 1
          fi
          
          echo "‚úÖ __init__.py validation passed"
          
          # Check translations
          if [ ! -d "custom_components/nettleie/translations" ]; then
            echo "‚ö†Ô∏è No translations directory found (recommended)"
          else
            if [ ! -f "custom_components/nettleie/translations/en.json" ]; then
              echo "‚ö†Ô∏è No English translation found (recommended)"
            else
              echo "‚úÖ English translation found"
            fi
          fi
          
          # Check README
          if [ ! -f "README.md" ]; then
            echo "‚ùå Missing README.md"
            exit 1
          fi
          
          # Check for HACS badge
          if ! grep -q "hacs_badge" README.md; then
            echo "‚ö†Ô∏è No HACS badge in README (recommended)"
          fi
          
          echo "‚úÖ All HACS requirements checked!"

  screenshot-check:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check for screenshots
        run: |
          echo "üì∏ Checking for screenshots..."
          
          if ls *.png *.jpg *.jpeg *.svg 2> /dev/null; then
            echo "‚úÖ Found screenshots:"
            ls *.png *.jpg *.jpeg *.svg 2> /dev/null
          else
            echo "‚ö†Ô∏è No screenshots found (recommended for HACS)"
            echo "   Add screenshots to show the integration in action"
          fi
